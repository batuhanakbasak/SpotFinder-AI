ğŸ”— Base URL

Lokal geliÅŸtirme iÃ§in:

http://localhost:8000/api


Sunucuya attÄ±ÄŸÄ±nda:

http://<server-ip>:8000/api

ğŸ” GÃ¼venlik / Kimlik DoÄŸrulama MantÄ±ÄŸÄ±

KullanÄ±cÄ± giriÅŸi (login) yok, sistem anonim.

Her /parking/start Ã§aÄŸrÄ±sÄ±nda backend:

session_id

session_token (gÃ¼Ã§lÃ¼ random, 64 karakterlik hex)

Ã¼retip dÃ¶ner.

/parking/end Ã§aÄŸÄ±rÄ±rken mutlaka hem session_id hem session_token gÃ¶nderilmelidir.
BÃ¶ylece sadece o oturumu baÅŸlatan cihaz, parkÄ± sonlandÄ±rabilir.

ğŸ©º 1. Health Check
GET /api/health

AmaÃ§: Backend + DB ayakta mÄ± diye kontrol.

Ã–rnek:

curl http://localhost:8000/api/health


Ã–rnek cevap:

{
  "status": "ok",
  "db": "connected"
}

ğŸ“ 2. Zones (bÃ¶lgeler)
2.1 GET /api/zones

AmaÃ§: Harita iÃ§in tÃ¼m park zonelarÄ±nÄ± listele.

Ã–rnek:

curl http://localhost:8000/api/zones


Ã–rnek cevap:

[
  {
    "id": 1,
    "code": "Z1",
    "name": "ÄŒair Zone",
    "lat": 42.004,
    "lng": 21.441,
    "radius_m": 70,
    "capacity": 40
  },
  {
    "id": 2,
    "code": "Z2",
    "name": "KarpoÅ¡ Zone",
    "lat": 41.998,
    "lng": 21.391,
    "radius_m": 80,
    "capacity": 60
  }
]

2.2 GET /api/zones/nearest?lat=..&lng=..

AmaÃ§: GPS ile en yakÄ±n zoneâ€™u bulmak (mobil uygulama aÃ§Ä±ldÄ±ÄŸÄ±nda).

Ã–rnek:

curl "http://localhost:8000/api/zones/nearest?lat=41.995&lng=21.431"


Ã–rnek cevap:

{
  "zone_id": 3,
  "zone_code": "Z3",
  "distance_m": 23.5,
  "radius_m": 80,
  "inside": true
}

2.3 GET /api/zones/status

AmaÃ§: TÃ¼m zonelar iÃ§in realtime + AI tahmini verilerini almak.
(frontend harita ekranÄ± burayÄ± kullanÄ±r)

Ã–rnek:

curl http://localhost:8000/api/zones/status


Ã–rnek cevap:

[
  {
    "zone_id": 2,
    "zone_code": "Z2",
    "name": "KarpoÅ¡ Zone",
    "lat": 41.998,
    "lng": 21.391,
    "radius_m": 80,
    "capacity": 60,
    "current_occupied": 0,
    "current_free": 60,
    "pred": {
      "occupancy_next_hour": 0.0411,
      "wait_time_minutes": 0.0,
      "avg_duration_minutes": 49.16
    }
  }
]


AÃ§Ä±klama:

current_occupied â†’ ÅŸu an DBâ€™ye gÃ¶re dolu araÃ§ sayÄ±sÄ±

current_free â†’ capacity - current_occupied

pred.occupancy_next_hour â†’ 1 saat sonraki tahmini doluluk oranÄ± (0â€“1)

pred.wait_time_minutes â†’ zone full ise ilk boÅŸ yer iÃ§in bekleme sÃ¼resi

pred.avg_duration_minutes â†’ bu zoneâ€™da ortalama park sÃ¼resi tahmini

2.4 GET /api/zones/<id>/status

AmaÃ§: Tek bir zone iÃ§in detaylÄ± tahmin.

Ã–rnek:

curl http://localhost:8000/api/zones/2/status


Ã–rnek cevap: (yukarÄ±dakiyle aynÄ± format, tek obje)

ğŸš— 3. Parking AkÄ±ÅŸÄ±
3.1 POST /api/parking/start

AmaÃ§: KullanÄ±cÄ± â€œburaya park ettimâ€ dediÄŸinde session aÃ§ar.

Bodyâ€™de 3 senaryo var:

a) Sadece QR ile
{
  "qr_code": "Z2-KARPOS-ENTRY-1",
  "vehicle_plate": "SK-123-AB",
  "plate_country": "MK"
}

b) Sadece GPS ile
{
  "lat": 41.995,
  "lng": 21.431,
  "vehicle_plate": "34 ABC 987",
  "plate_country": "TR"
}

c) QR + GPS birlikte (en iyi senaryo)
{
  "qr_code": "Z2-KARPOS-ENTRY-1",
  "lat": 41.995,
  "lng": 21.431,
  "vehicle_plate": "B 1234 XY",
  "plate_country": "DE"
}


Ã–rnek curl:

curl -X POST http://localhost:8000/api/parking/start \
  -H "Content-Type: application/json" \
  -d '{
    "qr_code": "Z2-KARPOS-ENTRY-1",
    "vehicle_plate": "SK-123-AB",
    "plate_country": "MK"
  }'


Ã–rnek cevap:

{
  "session_id": 42,
  "session_token": "a94f3ac7b91f44ce9b8141e1f582b61d",
  "zone_id": 2,
  "zone_code": "Z2",
  "vehicle_plate": "SK-123-AB",
  "plate_country": "MK",
  "started_at": "2025-11-26T18:58:12.345678"
}


ğŸ“Œ Mobil uygulama bu cevaptaki session_id + session_tokenâ€™Ä± saklayacak
â€œYouâ€™re parked in Z2â€ ekranÄ± bu bilgilerle gÃ¶sterilir.

3.2 POST /api/parking/end

AmaÃ§: KullanÄ±cÄ± â€œpark yerinden ayrÄ±lÄ±yorumâ€ dediÄŸinde Ã§aÄŸrÄ±lÄ±r.

Body:

{
  "session_id": 42,
  "session_token": "a94f3ac7b91f44ce9b8141e1f582b61d"
}


Ã–rnek curl:

curl -X POST http://localhost:8000/api/parking/end \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": 42,
    "session_token": "a94f3ac7b91f44ce9b8141e1f582b61d"
  }'


Ã–rnek cevap:

{ "ok": true }


Backendâ€™in yaptÄ±ÄŸÄ±:

parking_sessions tablosunda:

status = ended

ended_at = NOW()

spot_events tablosuna:

event_type = 'became_free'
eventâ€™ini ekler.

ğŸ§± 4. Ã–zet akÄ±ÅŸ (frontend / mobil gÃ¶zÃ¼yle)

Uygulama aÃ§Ä±lÄ±r â†’ GET /api/zones ile zoneâ€™lar Ã§ekilir.

Harita Ã¼zerinde kullanÄ±cÄ± konumu alÄ±nÄ±p:

GET /api/zones/nearest?lat=..&lng=.. ile en yakÄ±n zone bulunabilir.

KullanÄ±cÄ± park eder â†’ QR veya GPS ile:

POST /api/parking/start
â†’ session_id + session_token saklanÄ±r.

â€œYouâ€™re parked in Z2â€ ekranÄ± gÃ¶sterilir.

KullanÄ±cÄ± ayrÄ±lÄ±r â†’ â€œIâ€™m leavingâ€ butonu:

POST /api/parking/end (session_id + session_token ile)

Ana harita ekranÄ±:

GET /api/zones/status ile realtime + predictive veriyi Ã§eker.